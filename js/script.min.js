window.onload = function () {
	function c() {
		new Swiper('.car-park-item_visible', {
			init: !0,
			speed: 400,
			spaceBetween: 100,
			navigation: {
				nextEl: '.car-park__item-next',
				prevEl: '.car-park__item-prev',
			},
			pagination: {
				el: '.slider-pagination',
				bulletClass: 'slider-pagination__bullet',
				bulletActiveClass: 'slider-pagination__bullet-active',
				clickable: !0,
			},
		});
	}
	function d() {
		if (
			((clientWidth = document.documentElement.clientWidth), 800 > clientWidth)
		)
			for (let b = 1; b < v.length; b++)
				v[b].classList.add('reviews-item-hidden'),
					v[b].classList.remove('reviews-item-visible');
	}
	function e(c) {
		const a = document.querySelectorAll(c);
		for (let d of a)
			d.addEventListener('click', function (c) {
				c.preventDefault();
				const a = d.dataset.target;
				document
					.querySelector(a)
					.scrollIntoView({ behavior: 'smooth', block: 'start' });
			});
	}
	const f = document.querySelectorAll('form'),
		g = document.querySelectorAll('input'),
		h = document.querySelector('.modal-window__wrapper'),
		i = document.querySelector('.modal-mail__text'),
		j = {
			loading: '\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430...',
			success:
				'\u0421\u043F\u0430\u0441\u0438\u0431\u043E! \u0421\u043A\u043E\u0440\u043E \u043C\u044B \u0441 \u0432\u0430\u043C\u0438 \u0441\u0432\u044F\u0436\u0435\u043C\u0441\u044F',
			failure:
				'\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A...',
		},
		k = async (d, a) => {
			i.textContent = j.loading;
			let b = await fetch(d, { method: 'POST', body: a });
			return await b.text();
		},
		l = () => {
			g.forEach(b => {
				b.value = '';
			});
		};
	f.forEach(f => {
		f.addEventListener('submit', a => {
			a.preventDefault(), console.log();
			const b = document.querySelector('.modal-mail'),
				c = document.querySelector('.form__details');
			h.classList.remove('modal-window__wrapper_visible'),
				c.classList.remove('form__details-show'),
				(b.style.display = 'flex'),
				(i.textContent = j.success);
			const d = new FormData(f);
			console.log(a.target.childNodes[5]),
				d.append('type', a.target.childNodes[5].childNodes[3].value),
				d.append('height', a.target.childNodes[5].childNodes[7].value),
				d.append('capacity', a.target.childNodes[5].childNodes[9].value),
				d.append('carrying', a.target.childNodes[5].childNodes[11].value),
				k('send.php', d)
					.then(b => {
						console.log(b), (i.textContent = j.success);
					})
					.catch(b => {
						(i.textContent = j.failure), console.log(b);
					})
					.finally(() => {
						l(),
							setTimeout(() => {
								b.style.display = 'none';
							}, 2e3),
							(document.body.style.overflow = 'scroll');
					});
		});
	});
	const m = document.querySelector('.modal-window__wrapper'),
		n = document.querySelectorAll('.car-park-item__btn'),
		o = document.querySelector('.form__details');
	n.forEach(b => {
		b.addEventListener('click', g => {
			const a = g.target;
			m.classList.add('modal-window__wrapper_visible'),
				m.classList.add('modal-details'),
				(document.body.style.overflow = 'hidden'),
				o.classList.add('form__details-show');
			const b = document.querySelector('input[name="type"]'),
				c = document.querySelector('input[name="height"]'),
				d = document.querySelector('input[name="capacity"]'),
				e = document.querySelector('input[name="carrying"]');
			(b.value = `${a.previousElementSibling.previousElementSibling.textContent}`),
				(c.value = `${a.previousElementSibling.children[1].textContent.trim()}`),
				(d.value = `${a.previousElementSibling.children[2].textContent.trim()}`),
				(e.value = `${a.previousElementSibling.children[3].textContent.trim()}`);
		});
	}),
		(function (e, a) {
			const b = document.querySelectorAll(e),
				c = document.querySelector(a);
			b.forEach(b => {
				b.addEventListener('click', () => {
					c.classList.add('modal-window__wrapper_visible'),
						(document.body.style.overflow = 'hidden');
				});
			}),
				c.addEventListener('click', d => {
					const a = d.target;
					(a.closest('.modal-window__close') ||
						!a.closest('.modal-window__inner')) &&
						(c.classList.remove('modal-window__wrapper_visible'),
						o.classList.remove('form__details-show'),
						(document.body.style.overflow = 'scroll'));
				});
		})('.modal-open-btn', '.modal-window__wrapper'),
		(function (i, a, b, c) {
			const d = document.querySelector(i),
				e = document.querySelector(a),
				f = document.querySelector(b),
				g = document.querySelector(c);
			d.addEventListener('click', c => {
				c.target && c.preventDefault();
				const a = c.target;
				a.closest('.burger') && d.classList.toggle('burger-active'),
					a.closest('.burger-active')
						? ((e.style.height = '100vh'),
						  (f.style.transform = 'translateY(0)'))
						: ((e.style.height = ''), (f.style.transform = ''));
			}),
				e.addEventListener('click', b => {
					(!b.target.closest('.burger-active') || b.target.closest(g)) &&
						(d.classList.remove('burger-active'),
						(e.style.height = ''),
						(f.style.transform = ''));
				});
		})('.burger', '.menu', '.menu__list', '.menu__link'),
		c();
	const p = document.querySelectorAll('.car-park__tab'),
		q = document.querySelectorAll('.swiper-container-card');
	for (let b = 0; b < p.length; b++)
		p[b].addEventListener('click', d => {
			p.forEach(b => {
				b.classList.remove('car-park__tab_active');
			}),
				d.preventDefault();
			const e = d.target;
			e.classList.contains('car-park__tab_active') ||
				(e.classList.add('car-park__tab_active'),
				q.forEach(b => {
					b.classList.remove('car-park-item_visible'),
						b.dataset.id === e.dataset.id &&
							(b.classList.add('car-park-item_visible'), c());
				}));
		});
	const r = document.querySelector('.price-content__show-all'),
		s = document.querySelectorAll('.price-item'),
		t = document.querySelector('.price__content');
	r.addEventListener('click', b => {
		b.preventDefault(),
			r.classList.contains('card-show')
				? s.forEach(b => {
						b.classList.remove('price-item-show'),
							(t.style.gridRowGap = ''),
							r.classList.remove('card-show'),
							(r.textContent = '\u0412\u0441\u0435 \u0446\u0435\u043D\u044B');
				  })
				: s.forEach(b => {
						b.classList.add('price-item-show'),
							(t.style.gridRowGap = '30px'),
							r.classList.add('card-show'),
							(r.textContent = '\u0421\u043A\u0440\u044B\u0442\u044C');
				  });
	});
	const u = document.querySelector('.reviews__more'),
		v = document.querySelectorAll('.reviews-item');
	d(),
		window.addEventListener('resize', d, !1),
		window.removeEventListener('resize', d, !1),
		u.addEventListener('click', b => {
			b.preventDefault(),
				v.forEach(b => {
					b.classList.contains('reviews-item-hidden')
						? (b.classList.remove('reviews-item-hidden'),
						  (u.textContent = '\u0421\u043A\u0440\u044B\u0442\u044C'),
						  (u.style.textAlight = 'center'))
						: !b.classList.contains('reviews-item-hidden') &&
						  !b.classList.contains('reviews-item-visible') &&
						  (b.classList.add('reviews-item-hidden'),
						  (u.textContent =
								'\u0412\u0441\u0435 \u043E\u0442\u0437\u044B\u0432\u044B'));
				});
		});
	const w = document.querySelectorAll('.reviews-item__text-block'),
		x = document.querySelectorAll('.reviews-item__text'),
		y = document.querySelectorAll('.reviews-item__text-more');
	x.forEach((d, e) => {
		const a = d.textContent.slice(0, 350);
		if (
			((x[e].style.bottom = `calc(-${x[e].clientHeight}px *1.2)`),
			(x[e].style.position = 'absolute'),
			w[e].insertAdjacentHTML(
				'afterbegin',
				`<p class="reviews-item__text-cut">${a}</p>`,
			),
			350 > d.textContent.length)
		)
			(y[e].style.display = 'none'), (d.style.margin = '0');
		else {
			const b = document.querySelectorAll('.reviews-item__text-cut');
			b[e].textContent += '...';
		}
	}),
		y.forEach((e, a) => {
			const b = document.querySelectorAll('.reviews-item__text-cut');
			'none' !== e.style.display &&
				e.addEventListener('click', c => {
					c.preventDefault(),
						e.classList.contains('show')
							? (e.classList.remove('show'),
							  (e.textContent =
									'\u0427\u0438\u0442\u0430\u0442\u044C \u043F\u043E\u043B\u043D\u043E\u0441\u0442\u044C\u044E'),
							  (b[a].style.position = 'relative'),
							  (b[a].style.top = '0'),
							  (x[a].style.bottom = `-${x[a].clientHeight}px`),
							  (x[a].style.position = 'absolute'))
							: (e.classList.add('show'),
							  (e.textContent = '\u0421\u043A\u0440\u044B\u0442\u044C'),
							  (b[a].style.position = 'absolute'),
							  (b[a].style.top = `-${b[a].clientHeight}px`),
							  (b[a].style.transition = 'all 0.3s ease-in-out'),
							  (x[a].style.bottom = '0'),
							  (x[a].style.position = 'relative'),
							  (x[a].style.transition = 'all 0.3s ease-in-out'));
				});
		});
	const z = document.querySelector('.overlay'),
		A = document.querySelector('.map');
	z.addEventListener('click', () => {
		'none' !== z.style.pointerEvents && (z.style.pointerEvents = 'none');
	}),
		A.addEventListener('mouseleave', () => {
			z.style.pointerEvents = '';
		}),
		A.addEventListener('touchmove', () => {
			z.style.pointerEvents = '';
		}),
		new Cleave('.feedback-form__input-phone', {
			phone: !0,
			phoneRegionCode: 'ru',
		}),
		new Cleave('.feedback-form__input-phone-modal', {
			phone: !0,
			phoneRegionCode: 'ru',
		});
	const B = document.querySelector('.toTop');
	window.addEventListener('scroll', () => {
		B.style.display = 480 < window.scrollY ? 'inline-block' : 'none';
	}),
		e('.toTop'),
		e('.menu__link'),
		setTimeout(function () {
			document.querySelector('.map-frame').src =
				'https://yandex.ru/map-widget/v1/?um=constructor%3A227a00235bd633403e0bda695a1be1a3dc7bace898eb2b30e5f11f3f500f6b01&amp;source=constructor';
		}, 5e3);
};
